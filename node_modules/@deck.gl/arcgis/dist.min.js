(function webpackUniversalModuleDefinition(root, factory) {
  if (typeof exports === 'object' && typeof module === 'object')
    module.exports = factory();
  else if (typeof define === 'function' && define.amd) define([], factory);
        else if (typeof exports === 'object') exports['deck'] = factory();
  else root['deck'] = factory();})(globalThis, function () {
"use strict";var __exports__=(()=>{var se=Object.create;var R=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var le=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty;var _=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports),fe=(e,n)=>{for(var t in n)R(e,t,{get:n[t],enumerable:!0})},P=(e,n,t,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of le(n))!ue.call(e,a)&&a!==t&&R(e,a,{get:()=>n[a],enumerable:!(o=ce(n,a))||o.enumerable});return e},v=(e,n,t)=>(P(e,n,"default"),t&&P(t,n,"default")),D=(e,n,t)=>(t=e!=null?se(de(e)):{},P(n||!e||!e.__esModule?R(t,"default",{value:e,enumerable:!0}):t,e)),he=e=>P(R({},"__esModule",{value:!0}),e);var z=_((ye,W)=>{W.exports=globalThis.deck});var Y=_((De,Q)=>{Q.exports=globalThis.luma});var ee=_((T,$)=>{(function(e,n){typeof T=="object"&&typeof $<"u"?n(T):typeof define=="function"&&define.amd?define(["exports"],n):n(e.esriLoader=e.esriLoader||{})})(T,function(e){"use strict";var n=typeof window<"u",t={Promise:n?window.Promise:void 0},o="4.25",a="next";function c(r){if(r.toLowerCase()===a)return a;var i=r&&r.match(/^(\d)\.(\d+)/);return i&&{major:parseInt(i[1],10),minor:parseInt(i[2],10)}}function d(r){return r===void 0&&(r=o),"https://js.arcgis.com/".concat(r,"/")}function h(r){r===void 0&&(r=o);var i=d(r),s=c(r);if(s!==a&&s.major===3){var l=s.minor<=10?"js/":"";return"".concat(i).concat(l,"esri/css/esri.css")}else return"".concat(i,"esri/themes/light/main.css")}function w(r){var i=document.createElement("link");return i.rel="stylesheet",i.href=r,i}function k(r,i){if(i){var s=document.querySelector(i);s.parentNode.insertBefore(r,s)}else document.head.appendChild(r)}function x(r){return document.querySelector('link[href*="'.concat(r,'"]'))}function A(r){return!r||c(r)?h(r):r}function b(r,i){var s=A(r),l=x(s);return l||(l=w(s),k(l,i)),l}var L={};function te(r){var i=document.createElement("script");return i.type="text/javascript",i.src=r,i.setAttribute("data-esri-loader","loading"),i}function J(r,i,s){var l;s&&(l=ne(r,s));var u=function(){i(r),r.removeEventListener("load",u,!1),l&&r.removeEventListener("error",l,!1)};r.addEventListener("load",u,!1)}function ne(r,i){var s=function(l){i(l.error||new Error("There was an error attempting to load ".concat(r.src))),r.removeEventListener("error",s,!1)};return r.addEventListener("error",s,!1),s}function oe(r){r===void 0&&(r={}),L=r}function q(){return document.querySelector("script[data-esri-loader]")}function C(){var r=window.require;return r&&r.on}function j(r){r===void 0&&(r={});var i={};[L,r].forEach(function(u){for(var f in u)Object.prototype.hasOwnProperty.call(u,f)&&(i[f]=u[f])});var s=i.version,l=i.url||d(s);return new t.Promise(function(u,f){var p=q();if(p){var N=p.getAttribute("src");N!==l?f(new Error("The ArcGIS API for JavaScript is already loaded (".concat(N,")."))):C()?u(p):J(p,u,f)}else if(C())f(new Error("The ArcGIS API for JavaScript is already loaded."));else{var V=i.css;if(V){var ae=V===!0;b(ae?s:V,i.insertCssBefore)}p=te(l),J(p,function(){p.setAttribute("data-esri-loader","loaded"),u(p)},f),document.body.appendChild(p)}})}function H(r){return new t.Promise(function(i,s){var l=window.require.on("error",s);window.require(r,function(){for(var u=[],f=0;f<arguments.length;f++)u[f]=arguments[f];l.remove(),i(u)})})}function ie(r,i){if(i===void 0&&(i={}),C())return H(r);var s=q(),l=s&&s.getAttribute("src");return!i.url&&l&&(i.url=l),j(i).then(function(){return H(r)})}e.utils=t,e.loadModules=ie,e.getScript=q,e.isLoaded=C,e.loadScript=j,e.setDefaultOptions=oe,e.loadCss=b,Object.defineProperty(e,"__esModule",{value:!0})})});var S={};fe(S,{loadArcGISModules:()=>ve});var m={},X=D(z(),1);v(m,D(z(),1));if(!X.Layer)throw new Error("@deck.gl/core is not found");v(S,m);var K={layers:{},layerFilter:{},parameters:{},effects:{},pickingRadius:{},onBeforeRender:{},onAfterRender:{},onClick:{},onHover:{},onDragStart:{},onDrag:{},onDragEnd:{},onError:{},debug:{},drawPickingColors:{},getCursor:{},getTooltip:{}};function F(e){return e.createSubclass({properties:K,constructor(){this._callbacks={},this.watch(Object.keys(K),(t,o,a)=>{this.emit("change",{[a]:t})})},on(t,o){this._callbacks[t]=this._callbacks[t]||[],this._callbacks[t].push(o)},emit(t,o){let a=this._callbacks[t];if(a)for(let c of a)c(o)},toJSON(){let t={};for(let o of this.keys())this[o]!==void 0&&(t[o]=this[o]);return t}})}function G(e,n,t){return n.createSubclass({properties:{deck:{},blendMode:{},effect:{}},constructor(){this.deck=new e},createLayerView(o){return o.type==="2d"?new t({view:o,layer:this}):(console.error("DeckLayer does not support SceneView at the moment. Use DeckRenderer instead."),null)}})}var I=D(Y(),1),Z=D(z(),1);async function me(e){return new Promise(n=>{let t=new Z.Deck({controller:!1,gl:e,parameters:{depthCompare:"less-equal"},width:null,height:null,onDeviceInitialized:o=>{n({deckInstance:t,device:o})}})})}async function E(e){let{deckInstance:n,device:t}=await me(e),o=t.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),a=new I.Model(t,{vs:`#version 300 es
in vec2 pos;
out vec2 v_texcoord;
void main(void) {
    gl_Position = vec4(pos, 0.0, 1.0);
    v_texcoord = (pos + 1.0) / 2.0;
}
    `,fs:`#version 300 es
precision mediump float;
uniform sampler2D deckglTexture;
in vec2 v_texcoord;
out vec4 fragColor;

void main(void) {
    vec4 imageColor = texture(deckglTexture, v_texcoord);
    imageColor.rgb *= imageColor.a;
    fragColor = imageColor;
}
    `,bindings:{deckglTexture:o},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",blendColorSrcFactor:"one",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"},geometry:new I.Geometry({topology:"triangle-strip",attributes:{pos:{size:2,value:new Int8Array([-1,-1,1,-1,-1,1,-1,1,1,1,1,-1])}}}),vertexCount:6}),c=t.createFramebuffer({id:"deckfbo",width:1,height:1,colorAttachments:[o],depthStencilAttachment:"depth16unorm"});return n.setProps({_framebuffer:c,_customRender:d=>{d==="arcgis"?n._drawLayers(d):this.redraw()}}),{deck:n,texture:o,fbo:c,model:a}}function M(e,n){let{model:t,deck:o,fbo:a}=e,c=t.device,d=c.getParametersWebGL(36006),{width:h,height:w,...k}=n,x=window.devicePixelRatio,A=Math.round(h*x),b=Math.round(w*x);a.resize({width:A,height:b}),o.setProps({viewState:k}),o.redraw("arcgis");let L=c.beginRenderPass({framebuffer:d,parameters:{viewport:[0,0,A,b]},clearColor:!1,clearDepth:!1});try{t.draw(L)}finally{L.end()}}function g(e){e.deck.finalize(),e.model.destroy(),e.fbo.destroy(),e.texture.destroy()}function B(e){return e.createSubclass({properties:{cancelInitialization:null,resources:null},async attach(){let n=this.context,t=!1;this.cancelInitialization=()=>t=!0;let o=await E.call(this,n);if(t){g(o);return}this.resources=o,this.layer.deck.on("change",a=>o.deck.setProps(a)),o.deck.setProps(this.layer.deck.toJSON())},redraw(){this.requestRender()},detach(){this.cancelInitialization?.(),this.resources&&(g(this.resources),this.resources=null)},render(n){if(!this.resources)return;let[t,o]=this.view.state.size,a=n.state;M(this.resources,{width:t,height:o,latitude:this.view.center.latitude,longitude:this.view.center.longitude,zoom:this.view.featuresTilingScheme.scaleToLevel(a.scale),bearing:-a.rotation,pitch:0})}})}function pe(e,n){let t=Math.sqrt(1+n**2),o=e/2/180*Math.PI;return t/2/Math.tan(o)}function O(e,n){class t{constructor(a,c){this.resources=null,this.cancelInitialization=null,this.view=a,this.deck=new e(c)}async setup(a){let c=a.gl,d=!1;this.cancelInitialization=()=>d=!0;let h=await E.call(this,c);if(d){g(h);return}this.deck.on("change",w=>h.deck.setProps(w)),h.deck.setProps(this.deck.toJSON()),this.resources=h}dispose(){this.cancelInitialization?.(),this.resources&&g(this.resources)}redraw(){n.requestRender(this.view)}render(){let[a,c]=this.view.size;M(this.resources,{width:a,height:c,latitude:this.view.center.latitude,longitude:this.view.center.longitude,altitude:pe(this.view.camera.fov,a/c),zoom:this.view.zoom,bearing:this.view.camera.heading,pitch:this.view.camera.tilt})}}return t}var U=D(ee(),1),y;async function ve(e,n){let t=Array.isArray(e)?null:e;return await we(t,n),Array.isArray(e)?(0,U.loadModules)(e,n).then(o=>({...y,modules:o})):y}async function we(e,n){if(y)return y;if(e){let d=e.layers.Layer,h=e.core.Accessor,w=e.views["2d"].layers.BaseLayerViewGL2D,k=e.views["3d"].externalRenderers;return re(d,h,w,k)}let[t,o,a,c]=await(0,U.loadModules)(["esri/layers/Layer","esri/core/Accessor","esri/views/2d/layers/BaseLayerViewGL2D","esri/views/3d/externalRenderers"],n);return re(t,o,a,c)}function re(e,n,t,o){let a=F(n),c=B(t),d=G(a,e,c),h=O(a,o);return y={DeckLayer:d,DeckRenderer:h},y}return he(S);})();
      return __exports__;
      });
