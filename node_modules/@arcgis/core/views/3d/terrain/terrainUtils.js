/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import n from"../../../core/Collection.js";import{isCGCS2000 as t,isEarth as e}from"../../../geometry/support/spatialReferenceUtils.js";import{getTileMaxtrixSetFromActiveLayer as r}from"../../../layers/support/layerUtils.js";import{ViewingMode as o}from"../../ViewingMode.js";import{NeighborIndex as i}from"./NeighborIndex.js";import{isRasterTile as l,isTileTexture as u,isImageWithType as f,isVectorTile as c}from"./TerrainData.js";import{t as a}from"../../../chunks/terrainUtilsPlanar.js";import{t as T}from"../../../chunks/terrainUtilsSpherical.js";const s={[o.Global]:T,[o.Local]:a};function S(n,t){n||console.warn("Terrain: "+t)}let E=!1,m=!1;function p(n){m=n,E=E||n}function H(n){E=n}function O(n,t){if(E&&!n){const n=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+n),new Error("Assertion failed"+(t?": "+t:""))}}function y(n){return I(n)?{fullExtent:n.fullExtent,minScale:n.layer.minScale,maxScale:n.layer.maxScale,tilemapCache:null}:n.layer}function _(n){return"imagery-tile"===n?.type||"wcs"===n?.type}function I(n){return"imagery-tile-3d"===n?.type}function R(n){return"tile-3d"===n?.type}function d(n){return"vector-tile-3d"===n?.type}function N(n){return"wmts-3d"===n?.type}function U(n){return"elevation-3d"===n?.type}function W(n){return"elevation"===n?.type}function x(n){return"group"===n?.type}function A(n){return n&&(R(n)||N(n)||I(n)||d(n))}function h(n){return n&&(R(n)||I(n)||d(n)||N(n))}function L(n){return h(n)||U(n)}function g(n){return l(n?.sourceLayerInfo?.data)}function w(n){return v(n?.sourceLayerInfo)||!!n?.isVTLBackground}function C(n){return u(n?.sourceLayerInfo?.data)}function j(n){const t=n?.sourceLayerInfo?.data;return f(t)||t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData}function v(n){return c(n?.data)}function b(n){return null!=n&&"release"in n&&n.release(),null}function M(n){return n.fetchTile&&!1!==n.hasOverriddenFetchTile}function V(n,t,e,r,o){return s[r].checkIfTileInfoSupportedForViewSR(n,e,t,o)}function k(n,t,e){let r=null,i=null;if("wmts"===n?.type){const o=F(n,t,e);r=o.tileInfo,i=o.fullExtent}else{i=_(n)?n.getCompatibleFullExtent(t):n.fullExtent;const l=e===o.Local;if(_(n))r=n.getCompatibleTileInfo(t,i,l);else if("vector-tile"===n?.type){r=l&&!D(t)||G.force512VTL?n.tileInfo:n.tileInfo.getCompatibleForVTL(256)}else r=n.tileInfo}const l="tilemapCache"in n?n.tilemapCache?.effectiveMaxLOD:void 0;return null!=r&&null!=i&&null==V(r,i,t,e,l)?{tileInfo:r,fullExtent:i}:null}function F(t,e,o){const i=r(t);if(null!=i){if(!n.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find((n=>null==V(n.tileInfo,n.fullExtent,e,o)));if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function D(n){return n.isWGS84||n.isWebMercator||t(n)||!e(n)}const G={force512VTL:!1};function B(n){return"["+n[0]+","+n[1]+","+n[2]+"]"}function P(n){return"("+n[0]+","+n[1]+","+n[2]+")"}function q(n,t,e=en){return Math.abs(n-t)<e}function z(n){return n===i.NORTH_EAST?i.SOUTH_WEST:n===i.NORTH_WEST?i.SOUTH_EAST:n===i.SOUTH_WEST?i.NORTH_EAST:i.NORTH_WEST}function J(n){return n===i.NORTH?i.SOUTH:n===i.EAST?i.WEST:n===i.SOUTH?i.NORTH:i.EAST}function K(n){return n===i.NORTH_WEST||n===i.SOUTH_WEST}function Q(n){return n===i.NORTH_WEST||n===i.NORTH_EAST}function X(n){return n===i.NORTH_WEST||n===i.WEST||n===i.SOUTH_WEST}function Y(n){return n===i.NORTH_EAST||n===i.EAST||n===i.SOUTH_EAST}function Z(n){return n===i.SOUTH_EAST||n===i.SOUTH||n===i.SOUTH_WEST}function $(n){return n===i.NORTH_EAST||n===i.NORTH||n===i.NORTH_WEST}const nn=[i.NORTH,i.EAST,i.SOUTH,i.WEST],tn=[i.NORTH_EAST,i.SOUTH_EAST,i.SOUTH_WEST,i.NORTH_WEST],en=1e-5;export{q as almostEquals,V as checkIfTileInfoSupportedForView,H as enableInternalTerrainChecks,E as enableTerrainInternalChecks,p as enableTerrainWaterproofChecks,m as enableWaterproofTests,en as eps,y as getLayerWithExtentRange,F as getTileInfoAndExtentFromWMTSLayer,k as getTiledLayerInfo,O as internalAssert,A as isBlendableLayerView,Y as isEast,W as isElevationLayer,U as isElevationLayerView,x as isGroupLayerView,j as isImageSourceRenderInfo,I as isImageryTileLayerView,g as isImageryTileRenderInfo,h as isMapTileLayerView,$ as isNorth,Q as isNorthCorner,_ as isProjectableRasterLayer,Z as isSouth,L as isSurfaceLayerView,C as isTextureTileRenderInfo,R as isTileLayerView,d as isVectorTileLayerView,v as isVectorTilePerLayerInfo,w as isVectorTileRenderInfo,N as isWMTSLayerView,X as isWest,K as isWestCorner,B as lij2s,tn as neighborCornerIndices,nn as neighborEdgeIndices,z as oppositeCorner,J as oppositeEdge,b as releaseTerrainData,G as test,M as useFetchTileForLayer,P as v32s,D as vtlAssumes256PixelSizeAsDefault,S as weakAssert};
