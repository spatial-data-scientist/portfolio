/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{lerp as t}from"../../../../core/mathUtils.js";import{transpose as i}from"../../../../core/libs/gl-matrix-2/math/mat3.js";import{create as e}from"../../../../core/libs/gl-matrix-2/factories/mat3f64.js";import{l as s,p as o,o as a,c as h,f as n,t as c,j as r,b as _,m as p,g as m,n as l}from"../../../../chunks/vec32.js";import{create as f,clone as d,UNIT_Z as M,UNIT_Y as v,UNIT_X as g}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{ViewingMode as u}from"../../../ViewingMode.js";import{angle as w,slerp as y}from"../../support/mathUtils.js";class P{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(t){this.viewingMode=t,this.center=f(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=d(V),this._fov=55,this._size=1}pixelsPerPanAtZoom(t){return this._size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this._size/2/(this._zoomToPanScale*t)}pixelsPerRotateAtZoom(){const t=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/t}compareTo(t,i){if(this.viewingMode===u.Global){const e=(s(this.center)+s(t.center))/2;i.pan=w(this.center,t.center)*e}else i.pan=o(this.center,t.center);let e=Math.abs(t._yaw-this._yaw);e>=Math.PI&&(e=2*Math.PI-e);const a=Math.abs(t._pitch-this._pitch);i.rotate=Math.max(e,a),i.fov=t.fov-this.fov,i.sourceZoom=this._distance,i.targetZoom=t._distance}interpolate(i,e,s){this.viewingMode===u.Global?y(i.center,e.center,s.pan,this.center):a(this.center,i.center,e.center,s.pan),this._distance=isFinite(e.distance)?t(i.distance,e.distance+s.zoomOffset,s.zoom):i.distance,this._pitch=t(i.pitch,e.pitch,s.rotate);let o=i._yaw;const h=e._yaw;Math.abs(h-o)>=Math.PI&&(o+=2*(o<h?1:-1)*Math.PI),this._yaw=t(o,h,s.rotate),this._fov=t(i.fov,e.fov,s.fov)}copyFrom(t){h(this.center,t.center),this._pitch=t.pitch,this._yaw=t.yaw,this._distance=t.distance,h(this.direction,t.direction),this._size=t.size,this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const i=this._lookAtOrientation(t.center,S);h(this.center,t.center),n(j,t.center,t.eye),c(j,j,i),c(T,t.up,i),this._distance=s(j),0!==this._distance&&(j[0]/=this._distance,j[1]/=this._distance,j[2]/=this._distance),this._pitch=this._eyeUpToPitch(j),this._yaw=z(j,T),this._size=Math.sqrt(t.width*t.width+t.height*t.height),this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,S);i(e,e),this._axisAngleVec3(O,this._pitch-Math.PI/2,V,j),this._axisAngleVec3(k,this._yaw,j,j),this._axisAngleVec3(O,this._pitch-Math.PI/2,k,T),this._axisAngleVec3(k,this._yaw,T,T),r(j,j,this._distance),c(j,j,e),c(T,T,e),t.center=this.center,t.eye=n(j,this.center,j),t.up=T,t.fov=this._fov}_axisAngleVec3(t,i,e,s){const o=Math.cos(i),a=Math.sin(i);return r(A,e,o),_(x,t,e),r(x,x,a),r(b,t,(1-o)*p(t,e)),m(s,m(s,A,x),b)}_lookAtOrientation(t,i=e()){return this._upAtLookAt(t,b),_(A,this.direction,b),l(A,A),0===A[0]&&0===A[1]&&0===A[2]&&h(A,O),_(x,b,A),l(x,x),i[0]=A[0],i[1]=x[0],i[2]=b[0],i[3]=A[1],i[4]=x[1],i[5]=b[1],i[6]=A[2],i[7]=x[2],i[8]=b[2],i}_upAtLookAt(t,i){return this.viewingMode===u.Local?h(i,k):l(i,t)}_eyeUpToPitch(t){return Math.PI-w(k,t)}}function z(t,i){const e=I;return Math.abs(i[2])<.5?(h(e,i),t[2]>0&&r(e,e,-1)):h(e,t),_(x,e,k),l(x,x),w(O,x,k)}const A=f(),x=f(),b=f(),j=f(),T=f(),I=f(),k=M,V=v,O=g,S=e();export{P as Camera};
