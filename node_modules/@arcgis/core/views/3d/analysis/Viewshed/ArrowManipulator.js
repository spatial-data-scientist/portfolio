/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import e from"../../../../Color.js";import t from"../../../../core/Handles.js";import{deg2rad as r}from"../../../../core/mathUtils.js";import{watch as o,initial as i}from"../../../../core/reactiveUtils.js";import{fromTranslation as s,mul as n,fromXRotation as a,fromYRotation as c}from"../../../../core/libs/gl-matrix-2/math/mat4.js";import{create as l}from"../../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{h as m}from"../../../../chunks/vec32.js";import{fromValues as f}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{displayFocusMultiplier as p}from"../Slice/sliceToolConfig.js";import{createArcPolylineVertices as d}from"./FieldOfViewManipulation.js";import{scaleOrientArrowTipLength as u,scaleOrientArrowTipFocusMultiplier as h}from"./viewshedToolConfig.js";import{Manipulator3D as j}from"../../interactive/Manipulator3D.js";import{RenderObject as w}from"../../interactive/RenderObject.js";import{CullFaceOptions as b}from"../../webgl-engine/lib/basicInterfaces.js";import{createTubeGeometry as g,createExtrudedTriangle as v}from"../../webgl-engine/lib/GeometryUtil.js";import{RenderOccludedFlag as M}from"../../webgl-engine/lib/Material.js";import{ColorMaterial as _}from"../../webgl-engine/materials/ColorMaterial.js";import{ManipulatorStateFlags as O}from"../../../interactive/interfaces.js";class U extends j{constructor(e,r,o,i){super({view:e,autoScaleRenderObjects:!1,worldSized:!0,radius:5}),this._handles=new t,this._setupManipulatorVisual(r,o,i)}destroy(){this._handles.remove(),super.destroy()}_setupManipulatorVisual(e,t,o){const i=this._createMaterial(),u=r(t),h=e?1:Math.sin(u),j=e?d(0,u,h,[-h,0,0]):[f(0,0,0),f(0,0,h)],b=g(i,j,o,16,!1),v=g(i,j,o*p,16,!1),M=x(!1,i,o),_=x(!0,i,o),U=l();s(U,j[j.length-1]),n(U,U,a(C,Math.PI/2)),n(U,U,c(C,Math.PI/2)),e&&n(U,U,a(C,-u)),M.transformation=U,_.transformation=U,this.renderObjects=[new w(b,O.Unfocused),new w(v,O.Focused),new w(M,O.Unfocused),new w(_,O.Focused)];const T=f(0,y(!0),0),F=m(T,T,U),D=[...j,F];this.collisionType={type:"line",paths:[D]}}_createMaterial(){const t=new _({cullFace:b.Back,renderOccluded:M.OccludeAndTransparent,isDecoration:!0,writeLinearDepth:!0});return this._handles.add(o((()=>e.toUnitRGBA(this.view.effectiveTheme.accentColor)),(e=>t.setParameters({color:e})),i)),t}}function x(e,t,r){const o=y(e);let i=2*r;e&&(i*=p);const s=o/2;return v(t,o,s,s,i,0)}function y(e){let t=u;return e&&(t*=h),t}const C=l();export{U as ArrowManipulator};
