/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{ViewingMode as e}from"../../../ViewingMode.js";import{ShaderOutput as r}from"../core/shaderLibrary/ShaderOutput.js";import{a as i}from"../../../../chunks/Terrain.glsl.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as n}from"../core/shaderTechnique/ShaderTechnique.js";import{StencilBits as l}from"../lib/basicInterfaces.js";import{Program as s}from"../lib/Program.js";import{renderWhenBitIsNotSet as o}from"../lib/StencilUtils.js";import{VertexAttribute as a}from"../lib/VertexAttribute.js";import{BlendFactor as c,CompareFunction as u,SpecialDrawBuffers as d}from"../../../webgl/enums.js";import{makePipelineState as p,simpleBlendingParams as h,backFaceCullingParams as m,defaultDepthWriteParams as f,defaultColorWriteParams as g}from"../../../webgl/renderState.js";class b extends n{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(r,i){i.spherical=r.viewingMode===e.Global}initializeProgram(e){return new s(e.rctx,b.shader.get().build(this.configuration),S)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const i=this.configuration,t=i.backfaceCullingEnabled&&!i.renderOccluded;return p({blending:i.renderOccluded?h(c.ONE,c.ONE_MINUS_SRC_ALPHA):null,culling:t?m:null,depthTest:i.renderOccluded?null:{func:u.LESS},depthWrite:i.renderOccluded?null:f,colorWrite:g,stencilTest:e?o(l.IntegratedMeshMaskExcluded):null,drawBuffers:i.output===r.Depth?{buffers:[d.NONE]}:null})}getPipeline(){return this.useStencil?this._stencilPipelineState:super.getPipeline()}}b.shader=new t(i,(()=>import("../core/shaderLibrary/terrain/Terrain.glsl.js")));const S=new Map([[a.POSITION,0],[a.UV0,1],[a.NORMALCOMPRESSED,2]]);export{b as TerrainTechnique,S as terrainVertexAttributeLocations};
