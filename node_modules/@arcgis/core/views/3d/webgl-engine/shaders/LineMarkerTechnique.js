/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{ShaderOutput as e}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as t}from"../core/shaderTechnique/ShaderTechnique.js";import{blendingDefault as r,oitBlending as n,oitDepthTest as l,oitDepthWrite as s,oitDrawBuffers as o}from"../lib/OrderIndependentTransparency.js";import{Program as a}from"../lib/Program.js";import{stencilWriteMaskOn as c,stencilToolMaskBaseParams as p,stencilBaseAllZerosParams as u,depthCompareAlways as d,stencilToolTransparentOccluderParams as h,stencilWriteMaskOff as T,stencilToolMaskOccluderParams as m,depthCompareLess as f}from"../lib/StencilUtils.js";import{TransparencyPassType as P}from"../lib/TransparencyPassType.js";import{VertexAttribute as g}from"../lib/VertexAttribute.js";import{L as O}from"../../../../chunks/LineMarker.glsl.js";import{LineMarkerSpace as b}from"./LineMarkerTechniqueConfiguration.js";import{SpecialDrawBuffers as E}from"../../../webgl/enums.js";import{makePipelineState as S,defaultDepthWriteParams as W,defaultColorWriteParams as j}from"../../../webgl/renderState.js";const I=new Map([[g.POSITION,0],[g.PREVPOSITION,1],[g.UV0,2],[g.NORMAL,3],[g.COLOR,4],[g.COLORFEATUREATTRIBUTE,4],[g.SIZE,5],[g.SIZEFEATUREATTRIBUTE,5],[g.OPACITYFEATUREATTRIBUTE,6]]);class R extends t{initializeProgram(e){return new a(e.rctx,R.shader.get().build(this.configuration),I)}_makePipelineState(i,t){const a=this.configuration,d=i===P.NONE;return S({blending:a.output===e.Color?d?r:n(i):null,depthTest:a.space===b.Draped?null:{func:l(i)},depthWrite:a.space===b.Draped?null:d?a.writeDepth?W:null:s(i),drawBuffers:a.output===e.Depth?{buffers:[E.NONE]}:o(i),colorWrite:j,stencilWrite:a.hasOccludees?c:null,stencilTest:a.hasOccludees?t?p:u:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=S({blending:r,depthTest:d,depthWrite:null,colorWrite:j,stencilWrite:null,stencilTest:h}),this._occluderPipelineOpaque=S({blending:r,depthTest:d,depthWrite:null,colorWrite:j,stencilWrite:T,stencilTest:m}),this._occluderPipelineMaskWrite=S({blending:null,depthTest:f,depthWrite:null,colorWrite:null,stencilWrite:c,stencilTest:p})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipeline(e,i,t){return e?this._occludeePipelineState:this.configuration.occluder?t?this._occluderPipelineTransparent:i?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipeline()}}R.shader=new i(O,(()=>import("./LineMarker.glsl.js")));export{R as LineMarkerTechnique,I as vertexAttributeLocations};
