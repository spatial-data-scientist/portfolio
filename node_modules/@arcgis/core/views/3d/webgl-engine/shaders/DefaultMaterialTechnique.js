/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{fromArray as e,fromValues as t,create as i}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{fromValues as r}from"../../../../core/libs/gl-matrix-2/factories/vec4f64.js";import{ViewingMode as s}from"../../../ViewingMode.js";import{ShaderOutput as o}from"../core/shaderLibrary/ShaderOutput.js";import{NormalType as a}from"../core/shaderLibrary/attributes/NormalAttribute.glsl.js";import{TextureCoordinateAttributeType as l}from"../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl.js";import{VertexNormalPassParameters as n,VertexNormalDrawParameters as c}from"../core/shaderLibrary/attributes/VertexNormal.glsl.js";import{defaultMaskAlphaCutoff as h}from"../core/shaderLibrary/util/AlphaCutoff.js";import{ReloadableShaderModule as u}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as m}from"../core/shaderTechnique/ShaderTechnique.js";import{CullFaceOptions as p,DepthTestFunction as d,AlphaDiscardMode as f}from"../lib/basicInterfaces.js";import{Default3D as b}from"../lib/DefaultVertexAttributeLocations.js";import{RenderOccludedFlag as g}from"../lib/Material.js";import{blendingDefault as y,oitBlending as x,oitDepthTest as T,oitDrawBuffers as j,getOITPolygonOffset as P}from"../lib/OrderIndependentTransparency.js";import{Program as S}from"../lib/Program.js";import{stencilWriteMaskOn as O,stencilToolMaskBaseParams as v,stencilBaseAllZerosParams as C}from"../lib/StencilUtils.js";import{TransparencyPassType as L}from"../lib/TransparencyPassType.js";import{defaultAdvancedMRRFactors as M}from"../materials/pbrUtils.js";import{D as w}from"../../../../chunks/DefaultMaterial.glsl.js";import{SpecialDrawBuffers as A,CompareFunction as D}from"../../../webgl/enums.js";import{makePipelineState as N,cullingParams as F,defaultDepthWriteParams as _,defaultColorWriteParams as k}from"../../../webgl/renderState.js";class q extends n{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=e(M),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=p.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=t(0,0,0),this.instancedDoublePrecision=!1,this.normalType=a.Attribute,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=t(.2,.2,.2),this.diffuse=t(.8,.8,.8),this.externalColor=r(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=i(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=d.Less,this.textureAlphaMode=f.Blend,this.textureAlphaCutoff=h,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=g.Occlude,this.isDecoration=!1}}class z extends c{constructor(){super(...arguments),this.origin=i(),this.slicePlaneLocalOrigin=this.origin}}class E extends m{initializeConfiguration(e,t){t.spherical=e.viewingMode===s.Global,t.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,t.textureCoordinateType=t.hasColorTexture||t.hasMetallicRoughnessTexture||t.hasEmissionTexture||t.hasOcclusionTexture||t.hasNormalTexture?l.Default:l.None,t.objectAndLayerIdColorInstanced=t.instanced}initializeProgram(e){return this._initializeProgram(e,E.shader)}_initializeProgram(e,t){return new S(e.rctx,t.get().build(this.configuration),b)}_makePipeline(e,t){const i=this.configuration,r=e===L.NONE,s=e===L.FrontFace;return N({blending:i.output===o.Color&&i.transparent?r?y:x(e):null,culling:R(i)?F(i.cullFace):null,depthTest:{func:T(e,I(i.customDepthTest))},depthWrite:(r||s)&&i.writeDepth?_:null,drawBuffers:i.output===o.Depth?{buffers:[A.NONE]}:j(e),colorWrite:k,stencilWrite:i.hasOccludees?O:null,stencilTest:i.hasOccludees?t?v:C:null,polygonOffset:r||s?null:P(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function I(e){return e===d.Lequal?D.LEQUAL:D.LESS}function R(e){return e.cullFace!==p.None||!e.hasSlicePlane&&(!e.transparent&&!e.doubleSidedMode)}E.shader=new u(w,(()=>import("./DefaultMaterial.glsl.js")));export{z as DefaultMaterialDrawParameters,q as DefaultMaterialPassParameters,E as DefaultMaterialTechnique};
