/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import has from"../../../../core/has.js";import{ZEROS as e}from"../../../../core/libs/gl-matrix-2/factories/vec4f64.js";import{newLayout as r}from"../../support/buffer/InterleavedLayout.js";import{ShaderOutput as t,isColorOrOID as s,isDepth as a,is2DGeometryOutput as i}from"../core/shaderLibrary/ShaderOutput.js";import{CullFaceOptions as o}from"../lib/basicInterfaces.js";import n from"../lib/GLMaterial.js";import{OITPolygonOffsetLimit as h}from"../lib/OrderIndependentTransparency.js";import{RenderSlot as p}from"../lib/RenderSlot.js";import{VertexAttribute as c}from"../lib/VertexAttribute.js";import{DefaultBufferWriter as l}from"./DefaultBufferWriter.js";import{TriangleMaterial as u}from"./TriangleMaterial.js";import{VisualVariablePassParameters as m}from"./VisualVariablePassParameters.js";import{ColorMaterialTechnique as f}from"../shaders/ColorMaterialTechnique.js";import{ColorMaterialTechniqueConfiguration as _}from"../shaders/ColorMaterialTechniqueConfiguration.js";class d extends u{constructor(e){super(e,new g),this.supportsEdges=!0,this.produces=new Map([[p.OPAQUE_MATERIAL,e=>e===t.Highlight||s(e)&&!this._isTransparent],[p.OPAQUE_NO_SSAO_DEPTH,e=>a(e)&&this.parameters.writeLinearDepth&&!this._isTransparent],[p.TRANSPARENT_MATERIAL,e=>s(e)&&this._isTransparent&&this.parameters.writeDepth],[p.TRANSPARENT_NO_SSAO_DEPTH,e=>a(e)&&this.parameters.writeLinearDepth&&this._isTransparent&&this.parameters.writeDepth],[p.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,e=>(s(e)||a(e)&&this.parameters.writeLinearDepth)&&this._isTransparent&&!this.parameters.writeDepth],[p.DRAPED_MATERIAL,e=>i(e)]]),this._configuration=new _}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._isTransparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<h,this._configuration.multipassEnabled=r.multipassEnabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}createGLMaterial(e){return new T(e)}createBufferWriter(){const e=r().vec3f(c.POSITION);return has("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(c.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(c.COLORFEATUREATTRIBUTE):e.vec4u8(c.COLOR),new l(e)}get _isTransparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}}class T extends n{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output===t.Color&&this._updateOccludeeState(e),this.ensureTechnique(f,e)}}class g extends m{constructor(){super(...arguments),this.color=e,this.forceTransparentMode=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=o.None,this.hasOccludees=!1,this.draped=!1}}export{d as ColorMaterial,g as Parameters};
