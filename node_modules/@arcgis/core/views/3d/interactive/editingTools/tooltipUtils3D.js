/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{handlesGroup as t}from"../../../../core/handleUtils.js";import{watch as o,syncAndInitial as e,sync as i}from"../../../../core/reactiveUtils.js";import{manipulatedObjectGeometry as n}from"./manipulatedObjectUtils.js";import{AccumulationBehavior as r}from"../../../interactive/editGeometry/interfaces.js";import{connectPasteEvent as s,updateMeshTransformFromTooltipInfo as c,getXYZDeltasFromTooltipInfo as a,updateTooltipInfoFromMeshTransform as l}from"../../../interactive/tooltip/tooltipCommonUtils.js";import{elevationFromPoint as p}from"../../../support/euclideanLengthMeasurementUtils.js";function m(r,c,a){function l(){const t=a(),o=t.sketchOptions.tooltips.effectiveEnabled?t.activeTooltipInfo:null;return{...t,activeTooltipInfo:o}}let p=!1;function m({activeTooltipInfo:t,sketchOptions:o}){p=!0,t&&(t.sketchOptions=o,v(t,c)),r.info=t,p=!1}return t([o(l,m,e),o((()=>{const t=l(),{activeTooltipInfo:o}=t;if(o)return{context:t,activeTooltipInfo:o,key:o.key,geometry:n(c)}}),((t,o)=>{t&&!p&&o&&o.key!==t.key&&f(t.activeTooltipInfo,c,t.context)}),i),c.on("committed",(()=>m(l()))),s(r)])}function f(t,o,{callbacks:e}){const i=n(o);switch(i?.type){case"mesh":u(t,i.origin,o,e),"orientation"in t&&"scale"in t&&c(t,i,e);break;case"point":u(t,i,o,e)}}function u(t,o,e,i){const{dx:n,dy:s,dz:c}=a(t,o);0===n&&0===s&&0===c||(i.onMoveStart?.(),e.operations?.move(n,s,c,r.NEW_STEP),i.onMove?.(n,s,c),i.onMoveStop?.())}function v(t,o){const e=n(o);if(!t||!e||"mesh"!==e.type&&"point"!==e.type)return;const i="mesh"===e.type,r=i?e.origin:e;t.setLocationFromPoint(r),y(t,r,o),"transform-mesh"===t.type&&i&&l(t,e),t.clearInputValues()}function y(t,o,e){t.elevation.actual=p(o),t.elevation.visible=!!e.operations?.data.coordinateHelper.hasZ(),t.elevation.readOnly=!1,t.elevation.showAsZ=!0}export{m as connectTooltipToManipulatedObject,y as updateElevationFromPoint,v as updateTooltipInfoFromManipulatedObject,u as updateXYZFromTooltipInfo};
