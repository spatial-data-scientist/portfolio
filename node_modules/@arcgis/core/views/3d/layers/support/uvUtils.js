/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{create as t}from"../../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{set as o}from"../../../../core/libs/gl-matrix-2/math/vec2.js";import{create as r}from"../../../../core/libs/gl-matrix-2/factories/vec2f64.js";import{s as e,m as s,f as i,j as m,g as a,c as n,r as c,n as l,b as f}from"../../../../chunks/vec32.js";import{create as I}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{getReferenceEllipsoid as p}from"../../../../geometry/ellipsoidUtils.js";import{lonLatToWebMercatorComparable as N}from"../../../../geometry/projection/projectors.js";import{newDoubleArray as g}from"../../../../geometry/support/DoubleArray.js";import{create as h,fromArray as b,getNormal as u}from"../../../../geometry/support/plane.js";import{ViewingMode as j}from"../../../ViewingMode.js";function T(t,r,e,s,i=1){if(e.isGeographic&&s===j.Global){const t=g(r.length),o=r.length,s=p(e);for(let e=0;e<o;e+=3)N(r,e,t,e,s);r=t}o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let o=0;o<r.length;o+=3)y[0]=Math.min(y[0],r[o]),y[1]=Math.min(y[1],r[o+1]);const m=y[0]%i,a=y[1]%i,n=y[0]-m,c=y[1]-a;for(let o=0;o<r.length;o+=3){const e=o/3*4;t[e]=(r[o]-n)/i,t[e+1]=(r[o+1]-c)/i,t[e+2]=n/i,t[e+3]=c/i}}function M(t,r,n,c,l=1){e(F,1,0,0),e(Y,0,1,0),e(_,0,0,1),D(x,n),b(V,n)&&O(V,F,Y,_,c,x),o(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),o(P,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let o=0;o<n.length;o+=3){e(E,n[o],n[o+1],n[o+2]);const t=s(F,E),r=s(Y,E);y[0]=Math.min(y[0],t),y[1]=Math.min(y[1],r),P[0]=Math.max(P[0],t),P[1]=Math.max(P[1],r)}const f=s(_,x);q(v,y[0],y[1],f,F,Y,_),q(A,P[0],y[1],f,F,Y,_),q(G,y[0],P[1],f,F,Y,_),i(A,A,v),m(A,A,.5),i(G,G,v),m(G,G,.5),a(v,v,A),a(v,v,G);const I=y[0]%l,p=y[1]%l,N=y[0]-I,g=y[1]-p;for(let o=0;o<n.length;o+=3){e(E,n[o],n[o+1],n[o+2]);const i=o/3,m=4*i;t[m]=(s(F,E)-N)/l,t[m+1]=(s(Y,E)-g)/l,t[m+2]=N/l,t[m+3]=g/l;const a=9*i;for(let t=0;t<3;t++)r[a+t]=v[t],r[a+t+3]=A[t],r[a+t+6]=G[t]}}const x=I(),E=I(),V=h(),F=I(),Y=I(),_=I(),y=r(),P=r(),v=I(),A=I(),G=I();function O(t,o,r,i,a,I){null!=a?(a.basisMatrixAtPosition(I,S),e(d,S[0],S[1],S[2]),e(k,S[4],S[5],S[6]),e(w,S[8],S[9],S[10])):(e(d,1,0,0),e(k,0,1,0),e(w,0,0,1));const p=u(t);s(p,w)<0&&m(p,p,-1),n(i,p);const N=s(p,k),g=s(p,d);Math.abs(N)>Math.abs(g)?(c(o,d,p,-g),l(o,o),f(r,o,p),l(r,r),m(r,r,-1)):(c(r,k,p,-N),l(r,r),f(o,r,p),l(o,o))}const S=t(),d=I(),k=I(),w=I();function D(t,o){e(U,0,0,0);for(let r=0;r<o.length-3;r+=3)U[0]+=o[r],U[1]+=o[r+1],U[2]+=o[r+2];m(t,U,1/(o.length/3-1))}const U=I();function q(t,o,r,s,i,m,a){e(t,o*i[0]+r*m[0]+s*a[0],o*i[1]+r*m[1]+s*a[1],o*i[2]+r*m[2]+s*a[2])}export{M as createMapSpaceUVCoords,T as createMapSpaceUVCoordsDraped};
