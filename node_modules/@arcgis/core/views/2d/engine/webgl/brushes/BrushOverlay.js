/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{textureBindingBitmap as e}from"../definitions.js";import{createProgramDescriptor as t}from"../Utils.js";import r from"./WGLBrush.js";import{BlendFactor as n,CompareFunction as o,DataType as s}from"../../../../webgl/enums.js";const i=()=>t("overlay",{geometry:[{location:0,name:"a_pos",count:2,type:s.FLOAT}],tex:[{location:1,name:"a_uv",count:2,type:s.UNSIGNED_SHORT}]});class a extends r{constructor(){super(...arguments),this._desc={vsPath:"overlay/overlay",fsPath:"overlay/overlay",attributes:new Map([["a_pos",0],["a_uv",1]])}}dispose(){}prepareState({context:e}){e.setBlendingEnabled(!0),e.setColorMask(!0,!0,!0,!0),e.setBlendFunctionSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),e.setStencilWriteMask(0),e.setStencilTestEnabled(!0),e.setStencilFunction(o.GREATER,255,255)}draw(t,r){const{context:n,painter:o,requestRender:s,allowDelayedRender:a}=t;if(!r.isReady)return;const{computedOpacity:u,dvsMat3:d,isWrapAround:c,perspectiveTransform:m,texture:f,wrapAroundShift:l}=r;t.timeline.begin(this.name);const p=o.materialManager.getProgram(this._desc);if(a&&null!=s&&!p.compiled)return void s();const _=i(),v=r.getVAO(n,_.bufferLayouts,_.attributes);v&&(n.bindVAO(v),n.useProgram(p),n.bindTexture(f,e),p.setUniformMatrix3fv("u_dvsMat3",d),p.setUniform1i("u_texture",e),p.setUniform1f("u_opacity",u),p.setUniform2fv("u_perspective",m),p.setUniform2fv("u_texSize",r.textureSize),p.setUniform1f("u_wrapAroundShift",0),r.draw(t.context),c&&(p.setUniform1f("u_wrapAroundShift",l),r.draw(t.context)),n.bindVAO(),t.timeline.end(this.name))}}export{a as default};
