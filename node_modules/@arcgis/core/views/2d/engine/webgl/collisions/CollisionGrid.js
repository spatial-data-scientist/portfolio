/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{clamp as t}from"../../../../../core/mathUtils.js";import{labelPlacementOffsetPadding as s}from"../definitions.js";import{StaticBitSet as i}from"../../../layers/features/support/StaticBitSet.js";const e=1,h=0,o=1,r=2;class l{constructor(t,s,h){this._width=t*h,this._height=s*h,this._pixelRatio=h;const o=Math.ceil(this._width/e),r=Math.ceil(this._height/e);this._cols=o,this._rows=r,this._cells=i.create(o*r)}insertMetrics(t){this._markMetrics(t)}hasCollision(t){let i=0;for(const{computedX:e,computedY:h,width:l,height:c}of t.bounds){const t=(l+s)*this._pixelRatio,a=(c+s)*this._pixelRatio;switch(this._collide(e,h,t,a)){case r:return r;case o:i++}}return i===t.bounds.length?o:h}getCellId(t,s){return t+s*this._cols}has(t){return this._cells.has(t)}hasRange(t,s){return this._cells.hasRange(t,s)}set(t){this._cells.set(t)}setRange(t,s){this._cells.setRange(t,s)}_collide(s,i,l,c){const a=s-l/2,n=i-c/2,_=a+l,f=n+c;if(_<0||f<0||a>this._width||n>this._height)return o;const u=t(Math.floor(a/e),0,this._cols),d=t(Math.floor(n/e),0,this._rows),m=t(Math.ceil(_/e),0,this._cols),p=t(Math.ceil(f/e),0,this._rows);for(let t=d;t<=p;t++)for(let s=u;s<=m;s++){const i=this.getCellId(s,t);if(this.has(i))return r}return h}_mark(s,i,h,o,r){const l=s-h/2,c=i-o/2,a=l+h,n=c+o,_=t(Math.floor(l/e),0,this._cols),f=t(Math.floor(c/e),0,this._rows),u=t(Math.ceil(a/e),0,this._cols),d=t(Math.ceil(n/e),0,this._rows);for(let t=f;t<=d;t++)for(let s=_;s<=u;s++){const i=this.getCellId(s,t);this.set(i)}return!1}_markMetrics(t){for(const{computedX:i,computedY:e,width:h,height:o}of t.bounds){const r=(h+s)*this._pixelRatio,l=(o+s)*this._pixelRatio;this._mark(i,e,r,l,t.entityTexel)}}}export{l as CollisionBitsetGrid,r as hasCollision,h as none,o as outsideExtent};
