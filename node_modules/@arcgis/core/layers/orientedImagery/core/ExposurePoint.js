/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../geometry.js";import{ClonableMixin as r}from"../../../core/Clonable.js";import t from"../../../core/Error.js";import{JSONSupport as o}from"../../../core/JSONSupport.js";import a from"../../../core/Logger.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import{cast as n}from"../../../core/accessorSupport/decorators/cast.js";import{enumeration as c}from"../../../core/accessorSupport/decorators/enumeration.js";import{reader as p}from"../../../core/accessorSupport/decorators/reader.js";import{subclass as s}from"../../../core/accessorSupport/decorators/subclass.js";import{writer as l}from"../../../core/accessorSupport/decorators/writer.js";import m from"./CameraOrientation.js";import u from"./cameraOrientationFactory.js";import{appendPrefixAndSuffix as y,getEffectiveElevationSource as d,orientedImageryTypeMap as f}from"./utils.js";import{CameraOrientationType as g}from"../enums/CameraOrientationType.js";import h from"../../../geometry/Point.js";function v(e){throw new t("exposure-point:missing-default-value",`a value for ${e} is missing in default properties`)}function w(e,r){throw new t("exposure-point:missing-attribute-value",`a value for ${e} is missing in attribute table`,{exposurePoint:r})}let O=class extends(r(o)){constructor(e){super(e),this.cameraOrientation=null,this.elevation=null,this.elevationSource=null,this.name=null,this.sourceMap=null}read(e,r){const t={},{attributes:o,layer:a,geometry:i}=e,n={};for(const c in o)t[c.toLowerCase()]=o[c],n[c.toLowerCase()]=c;super.read({geometry:i,layer:a??{},sourceMap:n,...t},r)}write(e,r){const t=super.write(e,r),{sourceMap:o}=this;if(!o||!t)return t;const a={};for(const i in t){const e=o[i.toLowerCase()];e&&(a[e]=t[i])}return a}readCameraHeading(e,r){const{cameraheading:t,camheading:o,layer:a}=r;return t??o??a.cameraHeading}readCameraHeight(e,r){const{cameraheight:t,avghtag:o,layer:a}=r;return t??o??a.cameraHeight}readCamOffset(e,r){const{cameraoffset:t,camoffset:o}=r;return t?.split(";").map(Number)??o?.split(";").map(Number)??null}writeCameraOffset(e,r){e&&(r.cameraOffset=e.join(";"))}readCameraOrientation(e,r){const{cameraorientation:t,camori:o}=r;return t??o}readCameraPitch(e,r){const{camerapitch:t,campitch:o,layer:a}=r;return t??o??a.cameraPitch}readCameraRoll(e,r){const{cameraroll:t,camroll:o,layer:a}=r;return t??o??a.cameraRoll}readDepthImage(e,r){const{depthimage:t,depthimg:o,layer:a}=r,i=t??o??null,{depthImagePathPrefix:n,depthImagePathSuffix:c}=a??{};return y(i,n,c)}readElevationSource(e,r){const{elevationsource:t,layer:o}=r,{demPathSuffix:a,demPathPrefix:i}=o;if(t){const e=this._parseIfJSON(t);return d(e,i,a)}return o.effectiveElevationSource}readFarDistance(e,r){const{fardistance:t,fardist:o,layer:a}=r;return t??o??a.farDistance}readHFOV(e,r){const{horizontalfieldofview:t,hfov:o,layer:a}=r;return t??o??a.horizontalFieldOfView}readImageURL(e,r){const{imagepath:t,layer:o}=r;t||w("imagePath",this);const{imagePathPrefix:a,imagePathSuffix:i}=o;return y(t,a,i)}readImageRotation(e,r){const{imagerotation:t,imgrot:o,layer:a}=r;return t??o??a.imageRotation}get isHorizontal(){return"horizontal"===this.orientedImageryType}get isInspection(){return"inspection"===this.orientedImageryType}get isNadir(){return"nadir"===this.orientedImageryType}get isOblique(){return"oblique"===this.orientedImageryType}get isSpherical(){return"360"===this.orientedImageryType}get location(){const{cameraOrientation:e,cameraHeight:r,elevation:t}=this;if(e){const{type:r,x:t,y:o,z:a,horizontalWKID:i}=e;return new h({x:t,y:o,z:a,spatialReference:{wkid:r===g.LTP?4326:i}})}if("number"!=typeof r)throw v("cameraHeight");const o=this.geometry.clone();return o.z=o.hasZ?o.z:(t??0)+r,o}readNearDistance(e,r){const{neardistance:t,neardist:o,layer:a}=r;return t??o??a.nearDistance}readOrientationAccuracy(e,r){const{accuracy:t,orientationaccuracy:o}=r;return o?.split(";").map(Number)??t?.split(";").map(Number)??null}writeOrientationAccuracy(e,r){e&&(r.orientationAccuracy=e.join(";"))}readOIType(e,r){const{orientedimagerytype:t,oitype:o,camerapitch:a,campitch:i,layer:n}=r,c=f.read(t??o??n.orientedImageryType),p=a??i??n.cameraPitch;return"oblique"===c?p<10?"nadir":"oblique":c}readVFOV(e,r){const{verticalfieldofview:t,vfov:o,layer:a}=r;return t??o??a.verticalFieldOfView}_parseIfJSON(e){let r=null;try{r=JSON.parse(e)}catch(t){a.getLogger(this).error("couldn't parse the given elevation source JSON",e,t)}return r}};e([i({type:Date,json:{write:{enabled:!0,target:"aquisitionDate"},name:"acquisitiondate"}})],O.prototype,"acquisitionDate",void 0),e([i({type:Number,json:{write:!0,read:{source:["cameraheading","camheading","layer.cameraHeading"]}}})],O.prototype,"cameraHeading",void 0),e([p("cameraHeading")],O.prototype,"readCameraHeading",null),e([i({type:Number,json:{write:!0}})],O.prototype,"cameraHeight",void 0),e([p("cameraHeight",["cameraheight","avghtag","layer.cameraHeight"])],O.prototype,"readCameraHeight",null),e([i()],O.prototype,"cameraOffset",void 0),e([p("cameraOffset",["cameraoffset","camoffset"])],O.prototype,"readCamOffset",null),e([l("cameraOffset")],O.prototype,"writeCameraOffset",null),e([i({json:{write:{writer:(e,r,t)=>{r[t]=e.toString()}}},type:m}),n((e=>e?u.getCameraOrientation(e):null))],O.prototype,"cameraOrientation",void 0),e([p("cameraOrientation",["cameraorientation","camori"])],O.prototype,"readCameraOrientation",null),e([i({type:Number,json:{write:!0}})],O.prototype,"cameraPitch",void 0),e([p("cameraPitch",["camerapitch","campitch","layer.cameraPitch"])],O.prototype,"readCameraPitch",null),e([i({type:Number,json:{write:!0}})],O.prototype,"cameraRoll",void 0),e([p("cameraRoll",["cameraroll","camroll","layer.cameraRoll"])],O.prototype,"readCameraRoll",null),e([i({json:{write:!0},type:String})],O.prototype,"depthImage",void 0),e([p("depthImage",["depthimage","depthimg"])],O.prototype,"readDepthImage",null),e([i({type:Number,json:{write:!0}})],O.prototype,"elevation",void 0),e([i({json:{write:!0},clonable:"reference"})],O.prototype,"elevationSource",void 0),e([p("elevationSource",["elevationsource","layer.effectiveElevationSource"])],O.prototype,"readElevationSource",null),e([i({json:{name:"exposurestationid",write:{target:"exposureStationId"}},type:String})],O.prototype,"exposureStationId",void 0),e([i({type:Number,json:{write:!0}})],O.prototype,"farDistance",void 0),e([p("farDistance",["fardistance","fardist","layer.farDistance"])],O.prototype,"readFarDistance",null),e([i({type:h,json:{name:"geometry"}})],O.prototype,"geometry",void 0),e([i({type:Number,json:{write:!0}})],O.prototype,"horizontalFieldOfView",void 0),e([p("horizontalFieldOfView",["horizontalfieldofview","hfov","layer.horizontalFieldOfView"])],O.prototype,"readHFOV",null),e([i({json:{write:!0},type:String})],O.prototype,"imagePath",void 0),e([p("imagePath",["imagepath"])],O.prototype,"readImageURL",null),e([i({type:Number,json:{write:!0}})],O.prototype,"imageRotation",void 0),e([p("imageRotation",["imagerotation","imgrot","layer.imageRotation"])],O.prototype,"readImageRotation",null),e([i()],O.prototype,"isHorizontal",null),e([i()],O.prototype,"isInspection",null),e([i()],O.prototype,"isNadir",null),e([i()],O.prototype,"isOblique",null),e([i()],O.prototype,"isSpherical",null),e([i()],O.prototype,"location",null),e([i({json:{write:!0},type:String})],O.prototype,"name",void 0),e([i({type:Number,json:{write:!0}})],O.prototype,"nearDistance",void 0),e([p("nearDistance",["neardistance","neardist","layer.nearDistance"])],O.prototype,"readNearDistance",null),e([i({json:{write:!0,name:"objectid"},type:Number})],O.prototype,"objectId",void 0),e([i()],O.prototype,"orientationAccuracy",void 0),e([p("orientationAccuracy",["accuracy","orientationaccuracy"])],O.prototype,"readOrientationAccuracy",null),e([l("orientationAccuracy")],O.prototype,"writeOrientationAccuracy",null),e([c(f)],O.prototype,"orientedImageryType",void 0),e([p("orientedImageryType",["orientedimagerytype","oitype","layer.orientedImageryType"])],O.prototype,"readOIType",null),e([i({type:Number,json:{name:"sortorder",write:{target:"sortOrder"}}})],O.prototype,"sortOrder",void 0),e([i({type:Object})],O.prototype,"sourceMap",void 0),e([i({type:Number,json:{write:!0}})],O.prototype,"verticalFieldOfView",void 0),e([p("verticalFieldOfView",["verticalfieldofview","vfov","layer.verticalFieldOfView"])],O.prototype,"readVFOV",null),O=e([s("esri.layers.orientedImagery.core.ExposurePoint")],O);const j=O;export{j as default};
