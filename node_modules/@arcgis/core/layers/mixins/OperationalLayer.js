/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../TimeExtent.js";import t from"../../core/Error.js";import{isBlobProtocol as i}from"../../core/urlUtils.js";import{property as o}from"../../core/accessorSupport/decorators/property.js";import{Integer as s,Null as n}from"../../core/accessorSupport/ensureType.js";import"../../core/RandomLCG.js";import"../../core/has.js";import{reader as a}from"../../core/accessorSupport/decorators/reader.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import{writer as l}from"../../core/accessorSupport/decorators/writer.js";import{excludeTables as y}from"../../core/accessorSupport/layerContainerType.js";import{readLoadable as m}from"../../core/accessorSupport/read.js";import{willPropertyWrite as c}from"../../core/accessorSupport/write.js";import{supportedTypes as d}from"./operationalLayers.js";import{listMode as u,opacity as w}from"../support/commonProperties.js";const b=b=>{let T=class extends b{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,r,t){return"Group Layer"===t?.portalItem?.type?void 0:e}writeListMode(e,r,t,i){(i&&"ground"===i.layerContainerType||e&&c(this,t,{},i))&&(r[t]=e)}writeOperationalLayerType(e,r,t,i){e&&"tables"!==i?.layerContainerType&&(r.layerType=e)}writeTitle(e,r){r.title=e??"Layer"}readTimeExtent(e){return e?r.fromArray(e):null}writeTimeExtent(e,r,i,o){e&&"tables"!==o.layerContainerType&&(e.isEmpty?o?.messages&&o.messages.push(new t("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[i]=e.toArray())}read(e,r){r&&(r.layer=this),m(this,e,(r=>super.read(e,r)),r)}write(e,r){if(!this.persistenceEnabled&&!r?.ignorePersistenceEnabled)return null;if(r?.origin){const e=`${r.origin}/${r.layerContainerType||"operational-layers"}`,i=d[e];let o=!!i?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(o=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(o=!1),!o)return r.messages?.push(new t("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const o=super.write(e,{...r,layer:this}),s=!!r&&!!r.messages&&!!r.messages.filter((e=>e instanceof t&&"web-document-write:property-required"===e.name)).length;return i(o?.url)?(r?.messages?.push(new t("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:o}beforeSave(){}};return e([o({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],T.prototype,"id",void 0),e([a("id",["id"])],T.prototype,"readId",null),e([o(u)],T.prototype,"listMode",void 0),e([l("listMode")],T.prototype,"writeListMode",null),e([o({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:y}}}}})],T.prototype,"operationalLayerType",void 0),e([l("operationalLayerType")],T.prototype,"writeOperationalLayerType",null),e([o(w)],T.prototype,"opacity",void 0),e([o({type:Boolean,readOnly:!1})],T.prototype,"persistenceEnabled",void 0),e([o({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],T.prototype,"title",void 0),e([l("title"),l(["web-scene"],"title")],T.prototype,"writeTitle",null),e([o({type:r,json:{origins:{"web-scene":{write:{layerContainerTypes:y}}}}})],T.prototype,"visibilityTimeExtent",void 0),e([a("visibilityTimeExtent")],T.prototype,"readTimeExtent",null),e([l(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[s,n]]}})],T.prototype,"writeTimeExtent",null),e([o({type:Boolean,json:{origins:{"web-scene":{name:"visibility",write:{enabled:!0,layerContainerTypes:y}}},name:"visibility",write:!0}})],T.prototype,"visible",void 0),T=e([p("esri.layers.mixins.OperationalLayer")],T),T};function T(e){return"operationalLayerType"in e}export{b as OperationalLayer,T as isOperationalLayer};
