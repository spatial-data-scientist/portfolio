/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import r from"../../core/Error.js";import{NumericIdentifiableMixin as o}from"../../core/Identifiable.js";import t from"../../core/Loadable.js";import s from"../../core/Logger.js";import{MultiOriginJSONMixin as n}from"../../core/MultiOriginJSONSupport.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/RandomLCG.js";import{reader as c}from"../../core/accessorSupport/decorators/reader.js";import{subclass as p}from"../../core/accessorSupport/decorators/subclass.js";import{writer as a}from"../../core/accessorSupport/decorators/writer.js";import l from"./ControlPointsGeoreference.js";import m from"./CornersGeoreference.js";import f from"./ExtentAndRotationGeoreference.js";import u from"./GeoreferenceBase.js";import{toControlPointsGeoreference as d}from"./mediaUtils.js";const y={key:"type",base:u,typeMap:{"control-points":l,corners:m,"extent-and-rotation":f}},g={key:"type",base:u,typeMap:{"control-points":l}};let h=class extends(o(n(t))){constructor(e){super(e),this.georeference=null,this.opacity=1}readGeoreference(e){return l.fromJSON(e)}writeGeoreference(e,o,t,n){const i=n?.resources?.pendingOperations,c=()=>{const i=d(this.georeference,this.contentWidth,this.contentHeight);if(i){if("control-points"!==e.type&&s.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${e.type}' has been automatically converted.`),4!==i.controlPoints?.length&&n?.messages)return void n.messages.push(new r("property:unsupported","only 'control-points' georeference with 4 control points may be persisted."));o[t]=i.write({},n)}};if("control-points"!==e.type&&!this.loaded&&i)return o[t]={},void i.push(this.load().then(c));c()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(e){const{georeference:r,contentWidth:o,contentHeight:t}=this;if(null==e||null==r||0===o||0===t)return null;const s=r.toSourceNormalized(e);return null==s?null:(s.x*=o,s.y*=t,s)}};e([i({types:y,json:{write:!0,types:g}})],h.prototype,"georeference",void 0),e([c("georeference")],h.prototype,"readGeoreference",null),e([a("georeference")],h.prototype,"writeGeoreference",null),e([i({json:{read:!1,write:!1}})],h.prototype,"opacity",void 0),h=e([p("esri.layers.support.MediaElementBase")],h);const j=h;export{j as default};
