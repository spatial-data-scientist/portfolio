/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{_ as e}from"../../chunks/tslib.es6.js";import{isSome as t}from"../../core/arrayUtils.js";import{destroyMaybe as s}from"../../core/maybe.js";import{generateUID as l}from"../../core/uid.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import o from"../Widget.js";import{loadCalciteComponents as r}from"./componentsUtils.js";import{globalCss as a}from"./globalCss.js";import{loadLabeledSwitchComponents as d,LabeledSwitch as c}from"./LabeledSwitch.js";import"./widgetUtils.js";import{messageBundle as p}from"./decorators/messageBundle.js";import{tsx as g}from"./jsxFactory.js";import h from"./SnappingControls/SnappingControlsViewModel.js";import{itemTitleMatchesFilter as u}from"./SnappingControls/snappingLayerListUtils.js";import b from"./SnappingControls/VisibleElements.js";const m="esri-snapping-controls",y={base:m,container:`${m}__container`,item:`${m}__item`,toggleBlock:`${m}__toggle-block`,layerListBlock:`${m}__layer-list-block`,layerList:`${m}__layer-list`,layerListFilter:`${m}__layer-list__filter`,layerListButton:`${m}__layer-list__button`,layerListItem:`${m}__layer-list__item`,layerListGroup:`${m}__layer-list__group`,nestedContainer:`${m}__nested-container`};let _=class extends o{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this.layerListOpen=!0,this.messages=null,this.visibleElements=new b,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),requestAnimationFrame((()=>e.target.setFocus()))};const{snappingOptions:s,view:l,viewModel:i}=e;this.viewModel=i??(this._defaultViewModel=new h({snappingOptions:s,view:l}))}normalizeCtorArgs(e){const{snappingOptions:t,view:s,viewModel:l,...i}=e;return i}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=s(this._defaultViewModel))}loadDependencies(){return Promise.all([r({block:()=>import("@esri/calcite-components/dist/components/calcite-block.js"),button:()=>import("@esri/calcite-components/dist/components/calcite-button.js"),input:()=>import("@esri/calcite-components/dist/components/calcite-input.js"),list:()=>import("@esri/calcite-components/dist/components/calcite-list.js"),"list-item":()=>import("@esri/calcite-components/dist/components/calcite-list-item.js"),checkbox:()=>import("@esri/calcite-components/dist/components/calcite-checkbox.js")}),d()])}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=s(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return g("div",{"aria-label":e,class:this.classes(y.base,a.widget)},g("div",{class:y.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const{visibleElements:e}=this,s=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null].filter(t),l=[e.enabledToggle?this._renderEnabledToggle():null,s.length>0?g("div",{class:y.nestedContainer},s):null].filter(t);return 0===l.length?null:g("calcite-block",{class:y.toggleBlock,heading:e.header?this.label:"",key:"toggle-block",open:!0},l)}_renderEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:s}=t;return g(c,{checked:s.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:e.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:s}=t,l=s.enabled&&s.selfEnabled;return g(c,{checked:l,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:e.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){const{messages:e,viewModel:t}=this,{snappingOptions:s}=t,l=s.enabled&&s.featureEnabled;return g(c,{checked:l,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:e.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,s=({target:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")},l=t.layerListViewModel.operationalItems.length>9?g("calcite-input",{class:y.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:s}):null,i=this._secondaryElementsDisabled,n=this.layerListOpen&&!i;return g("calcite-block",{class:y.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,heading:e.snappingLayers,key:"list-block",open:n,onCalciteBlockToggle:e=>this.layerListOpen=e.target.open},l,this._renderToggleLayersButton(),g("calcite-list",{class:y.layerList,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderLayerListItemCollection(e){const s=this._layerListFilter;return e.map((e=>{switch(s?u(e,s):null){case"children":{const t=e.children.filter((e=>!1!==u(e,s)));return this._renderLayerListItemGroup(e,t)}case"self":case null:return this._renderLayerListItemOrGroup(e);case!1:return"self"===u(e.parent,s)?this._renderLayerListItemOrGroup(e):null}})).toArray().filter(t)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,s=e?t.disableAllLayers:t.enableAllLayers;return g("calcite-button",{appearance:"transparent",class:y.layerListButton,label:s,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},s)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,s=e.title||t,l=()=>{this.viewModel.toggleSnappingForLayers([e.layer.id],"enabled"!==e.enabled)};return g("calcite-list-item",{class:y.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:s,onCalciteListItemSelect:e=>{e.stopPropagation(),l()}},g("calcite-checkbox",{checked:"enabled"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:l}))}_renderLayerListItemGroup(e,t){const{children:s,title:i}=e,n=i||this.messages.untitledLayer,o=i&&""!==i?i:l(),r=!!t?.length,a=t??s,d=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,"enabled"!==e.enabled)};return g("calcite-list-item",{class:y.layerListGroup,key:o,label:n,open:r,onCalciteListItemSelect:e=>{e.stopPropagation(),d()}},g("calcite-checkbox",{checked:"enabled"===e.enabled,indeterminate:"indeterminate"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:d}),g("calcite-list",null,this._renderLayerListItemCollection(a)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};e([i()],_.prototype,"_defaultViewModel",void 0),e([i()],_.prototype,"_layerListFilter",void 0),e([i()],_.prototype,"label",null),e([i({type:Boolean,nonNullable:!0})],_.prototype,"layerListOpen",void 0),e([i(),p("esri/widgets/support/SnappingControls/t9n/SnappingControls")],_.prototype,"messages",void 0),e([i()],_.prototype,"snappingOptions",null),e([i()],_.prototype,"view",null),e([i()],_.prototype,"viewModel",null),e([i({type:b,nonNullable:!0})],_.prototype,"visibleElements",void 0),e([i()],_.prototype,"_enabledToggleDisabled",null),e([i()],_.prototype,"_secondaryElementsDisabled",null),_=e([n("esri.widgets.support.SnappingControls")],_);const L=_;export{L as default};
