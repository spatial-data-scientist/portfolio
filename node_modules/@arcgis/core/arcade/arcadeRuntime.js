/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
import{ArcadeModule as e}from"./ArcadeModule.js";import{ArcadeModuleLoader as t}from"./ArcadeModuleLoader.js";import{getNestedOptionalValue as n,geometryMember as o}from"./containerUtils.js";import r from"./Dictionary.js";import{ArcadeExecutionError as l,ExecutionErrorCodes as i,ensureArcadeExecutionError as a}from"./executionError.js";import s from"./Feature.js";import{NativeFunction as c,ArcadeFunction as u,ScopeMarshalledFunction as f,wrapModuleScopedResponse as p}from"./FunctionWrapper.js";import{H as d,a as h,F as w,D as m,C as g,B as v,i as y,c as b,o as x,z as S,q as I,r as F,b as C,g as R,A,j as M,E,G as L,x as N}from"../chunks/languageUtils.js";import{addFunctionDeclaration as O}from"./treeAnalysis.js";import{A as B}from"../chunks/array.js";import{registerFunctions as j}from"./functions/date.js";import{registerFunctions as k}from"./functions/geometry.js";import{registerFunctions as D}from"./functions/geomsync.js";import{registerFunctions as U}from"./functions/maths.js";import{registerFunctions as K}from"./functions/stats.js";import{registerFunctions as q}from"./functions/string.js";import G from"../geometry/Geometry.js";import Z from"../geometry/SpatialReference.js";class P extends u{constructor(e,t){super(),this.definition=null,this.context=null,this.definition=e,this.context=t}createFunction(e){return(...t)=>{const n={spatialReference:this.context.spatialReference,console:this.context.console,services:this.context.services,timeZone:this.context.timeZone??null,lrucache:this.context.lrucache,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,localScope:{},depthCounter:{depth:e.depthCounter.depth+1},globalScope:this.context.globalScope};if(n.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,null);return Fe(this.definition,n,t,null)}}call(e,t){return V(e,t,((n,o,r)=>{const a={spatialReference:e.spatialReference,services:e.services,globalScope:e.globalScope,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,timeZone:e.timeZone??null,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(a.depthCounter.depth>64)throw new l(e,i.MaximumCallDepth,t);return Fe(this.definition,a,r,t)}))}marshalledCall(e,t,n,o){return o(e,t,((r,l,i)=>{const a={spatialReference:e.spatialReference,globalScope:n.globalScope,services:e.services,depthCounter:{depth:e.depthCounter.depth+1},libraryResolver:e.libraryResolver,exports:e.exports,console:e.console,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};return i=i.map((t=>!y(t)||t instanceof f?t:p(t,e,o))),p(Fe(this.definition,a,i,t),n,o)}))}}class T extends e{constructor(e){super(e)}global(e){const t=this.executingContext.globalScope[e.toLowerCase()];if(t.valueset||(t.value=_(this.executingContext,t.node),t.valueset=!0),y(t.value)&&!(t.value instanceof f)){const e=new f;e.fn=t.value,e.parameterEvaluator=V,e.context=this.executingContext,t.value=e}return t.value}setGlobal(e,t){if(y(t))throw new l(null,i.AssignModuleFunction,null);this.executingContext.globalScope[e.toLowerCase()]={value:t,valueset:!0,node:null}}hasGlobal(e){return void 0===this.executingContext.exports[e]&&(e=e.toLowerCase()),void 0!==this.executingContext.exports[e]}loadModule(e){let n=e.spatialReference;null==n&&(n=new Z({wkid:102100})),this.moduleScope=Re({},e.customfunctions,e.timeZone),this.executingContext={spatialReference:n,globalScope:this.moduleScope,localScope:null,libraryResolver:new t(e.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},services:e.services,console:e.console??Me,timeZone:e.timeZone??null,lrucache:e.lrucache,interceptor:e.interceptor,depthCounter:{depth:1}},_(this.executingContext,this.source.syntax)}}function W(e,t){const n=[];for(let o=0;o<t.arguments.length;o++)n.push(_(e,t.arguments[o]));return n}function V(e,t,n){try{return!0===t.preparsed?n(e,null,t.arguments):n(e,t,W(e,t))}catch(o){throw o}}function _(e,t){try{switch(t?.type){case"EmptyStatement":return v;case"VariableDeclarator":return ue(e,t);case"VariableDeclaration":return ce(e,t);case"ImportDeclaration":return ae(e,t);case"ExportNamedDeclaration":return se(e,t);case"BlockStatement":case"Program":return re(e,t);case"FunctionDeclaration":return ie(e,t);case"ReturnStatement":return le(e,t);case"IfStatement":return oe(e,t);case"ExpressionStatement":return ne(e,t);case"AssignmentExpression":return te(e,t);case"UpdateExpression":return $(e,t);case"BreakStatement":return g;case"ContinueStatement":return m;case"TemplateElement":return me(e,t);case"TemplateLiteral":return ve(e,t);case"ForStatement":return J(e,t);case"ForInStatement":return Y(e,t);case"WhileStatement":return Q(e,t);case"Identifier":return ye(e,t);case"MemberExpression":return fe(e,t);case"Literal":return t.value;case"CallExpression":return be(e,t);case"UnaryExpression":return pe(e,t);case"BinaryExpression":return he(e,t);case"LogicalExpression":return we(e,t);case"ArrayExpression":return de(e,t);case"ObjectExpression":return z(e,t);case"Property":return H(e,t);default:throw new l(e,i.Unrecognized,t)}}catch(n){throw a(e,t,n)}}function z(e,t){const n={},o=new Map;for(let r=0;r<t.properties.length;r++){const a=_(e,t.properties[r]);if(y(a.value))throw new l(e,i.NoFunctionInDictionary,t);if(!1===b(a.key))throw new l(e,i.KeyMustBeString,t);let s=a.key.toString();const c=s.toLowerCase();o.has(c)?s=o.get(c):o.set(c,s),a.value===v?n[s]=null:n[s]=a.value}const a=new r(n);return a.immutable=!1,a}function H(e,t){return{key:"Identifier"===t.key.type?t.key.name:_(e,t.key),value:_(e,t.value)}}function Y(e,t){const n=_(e,t.right);"VariableDeclaration"===t.left.type&&_(e,t.left);let o=null,a="";if("VariableDeclaration"===t.left.type){const e=t.left.declarations[0].id;"Identifier"===e.type&&(a=e.name)}else"Identifier"===t.left.type&&(a=t.left.name);if(!a)throw new l(e,i.InvalidIdentifier,t);if(a=a.toLowerCase(),null!=e.localScope&&void 0!==e.localScope[a]&&(o=e.localScope[a]),null===o&&void 0!==e.globalScope[a]&&(o=e.globalScope[a]),null===o)throw new l(e,i.InvalidIdentifier,t);if(x(n)||b(n)){const r=n.length;for(let n=0;n<r;n++){o.value=n;const r=_(e,t.body);if(r===g)break;if(r instanceof S)return r}return v}if(I(n)){for(let r=0;r<n.length();r++){o.value=r;const n=_(e,t.body);if(n===g)break;if(n instanceof S)return n}return v}if(!(n instanceof r||F(n)))return v;{const r=n.keys();for(let n=0;n<r.length;n++){o.value=r[n];const l=_(e,t.body);if(l===g)break;if(l instanceof S)return l}}}function J(e,t){null!==t.init&&_(e,t.init);const n={testResult:!0,lastAction:v};do{X(e,t,n)}while(!0===n.testResult);return n.lastAction instanceof S?n.lastAction:v}function Q(e,t){const n={testResult:!0,lastAction:v};if(n.testResult=_(e,t.test),!1===n.testResult)return v;if(!0!==n.testResult)throw new l(e,i.BooleanConditionRequired,t);for(;!0===n.testResult&&(n.lastAction=_(e,t.body),n.lastAction!==g)&&!(n.lastAction instanceof S);)if(n.testResult=_(e,t.test),!0!==n.testResult&&!1!==n.testResult)throw new l(e,i.BooleanConditionRequired,t);return n.lastAction instanceof S?n.lastAction:v}function X(e,t,n){if(null!==t.test){if(n.testResult=_(e,t.test),!1===n.testResult)return;if(!0!==n.testResult)throw new l(e,i.BooleanConditionRequired,t)}n.lastAction=_(e,t.body),n.lastAction!==g?n.lastAction instanceof S?n.testResult=!1:null!==t.update&&_(e,t.update):n.testResult=!1}function $(e,t){let n,o=null,a="";if("MemberExpression"===t.argument.type){if(o=_(e,t.argument.object),!0===t.argument.computed?a=_(e,t.argument.property):"Identifier"===t.argument.property.type&&(a=t.argument.property.name),x(o)){if(!C(a))throw new l(e,i.ArrayAccessorMustBeNumber,t);if(a<0&&(a=o.length+a),a<0||a>=o.length)throw new l(e,i.OutOfBounds,t);n=R(o[a]),o[a]="++"===t.operator?n+1:n-1}else if(o instanceof r){if(!1===b(a))throw new l(e,i.KeyAccessorMustBeString,t);if(!0!==o.hasField(a))throw new l(e,i.FieldNotFound,t);n=R(o.field(a)),o.setField(a,"++"===t.operator?n+1:n-1)}else if(F(o)){if(!1===b(a))throw new l(e,i.KeyAccessorMustBeString,t);if(!0!==o.hasField(a))throw new l(e,i.FieldNotFound,t);n=R(o.field(a)),o.setField(a,"++"===t.operator?n+1:n-1)}else{if(I(o))throw new l(e,i.Immutable,t);if(!(o instanceof T))throw new l(e,i.InvalidParameter,t);if(!1===b(a))throw new l(e,i.ModuleAccessorMustBeString,t);if(!0!==o.hasGlobal(a))throw new l(e,i.ModuleExportNotFound,t);n=R(o.global(a)),o.setGlobal(a,"++"===t.operator?n+1:n-1)}return!1===t.prefix?n:"++"===t.operator?n+1:n-1}if(o="Identifier"===t.argument.type?t.argument.name.toLowerCase():"",!o)throw new l(e,i.InvalidIdentifier,t);if(null!=e.localScope&&void 0!==e.localScope[o])return n=R(e.localScope[o].value),e.localScope[o]={value:"++"===t.operator?n+1:n-1,valueset:!0,node:t},!1===t.prefix?n:"++"===t.operator?n+1:n-1;if(void 0!==e.globalScope[o])return n=R(e.globalScope[o].value),e.globalScope[o]={value:"++"===t.operator?n+1:n-1,valueset:!0,node:t},!1===t.prefix?n:"++"===t.operator?n+1:n-1;throw new l(e,i.InvalidIdentifier,t)}function ee(e,t,n,o,r){switch(t){case"=":return e===v?null:e;case"/=":return R(n)/R(e);case"*=":return R(n)*R(e);case"-=":return R(n)-R(e);case"+=":return b(n)||b(e)?M(n)+M(e):R(n)+R(e);case"%=":return R(n)%R(e);default:throw new l(r,i.UnsupportedOperator,o)}}function te(e,t){let n=null,o="";if("MemberExpression"===t.left.type){if(n=_(e,t.left.object),!0===t.left.computed)o=_(e,t.left.property);else{if("Identifier"!==t.left.property.type)throw new l(e,i.InvalidIdentifier,t);o=t.left.property.name}const a=_(e,t.right);if(x(n)){if(!C(o))throw new l(e,i.ArrayAccessorMustBeNumber,t);if(o<0&&(o=n.length+o),o<0||o>n.length)throw new l(e,i.OutOfBounds,t);if(o===n.length){if("="!==t.operator)throw new l(e,i.OutOfBounds,t);n[o]=ee(a,t.operator,n[o],t,e)}else n[o]=ee(a,t.operator,n[o],t,e)}else if(n instanceof r){if(!1===b(o))throw new l(e,i.KeyAccessorMustBeString,t);if(!0===n.hasField(o))n.setField(o,ee(a,t.operator,n.field(o),t,e));else{if("="!==t.operator)throw new l(e,i.FieldNotFound,t,{key:o});n.setField(o,ee(a,t.operator,null,t,e))}}else if(F(n)){if(!1===b(o))throw new l(e,i.KeyAccessorMustBeString,t);if(!0===n.hasField(o))n.setField(o,ee(a,t.operator,n.field(o),t,e));else{if("="!==t.operator)throw new l(e,i.FieldNotFound,t,{key:o});n.setField(o,ee(a,t.operator,null,t,e))}}else{if(I(n))throw new l(e,i.Immutable,t);if(!(n instanceof T))throw new l(e,i.InvalidIdentifier,t);if(!1===b(o))throw new l(e,i.ModuleAccessorMustBeString,t);if(!0!==n.hasGlobal(o))throw new l(e,i.ModuleExportNotFound,t);n.setGlobal(o,ee(a,t.operator,n.global(o),t,e))}return v}n=t.left.name.toLowerCase();const a=_(e,t.right);if(null!=e.localScope&&void 0!==e.localScope[n])return e.localScope[n]={value:ee(a,t.operator,e.localScope[n].value,t,e),valueset:!0,node:t.right},v;if(void 0!==e.globalScope[n])return e.globalScope[n]={value:ee(a,t.operator,e.globalScope[n].value,t,e),valueset:!0,node:t.right},v;throw new l(e,i.InvalidIdentifier,t)}function ne(e,t){if("AssignmentExpression"===t.expression.type||"UpdateExpression"===t.expression.type)return _(e,t.expression);if("CallExpression"===t.expression.type){const n=_(e,t.expression);return n===v?v:new A(n)}{const n=_(e,t.expression);return n===v?v:new A(n)}}function oe(e,t){const n=_(e,t.test);if(!0===n)return _(e,t.consequent);if(!1===n)return null!==t.alternate?_(e,t.alternate):v;throw new l(e,i.BooleanConditionRequired,t)}function re(e,t){let n=v;for(let o=0;o<t.body.length;o++)if(n=_(e,t.body[o]),n instanceof S||n===g||n===m)return n;return n}function le(e,t){if(null===t.argument)return new S(v);const n=_(e,t.argument);return new S(n)}function ie(e,t){const n=t.id.name.toLowerCase();return e.globalScope[n]={valueset:!0,node:null,value:new P(t,e)},v}function ae(e,t){const n=t.specifiers[0].local.name.toLowerCase(),o=e.libraryResolver.loadLibrary(n);let r=null;return e.libraryResolver._moduleSingletons?.has(o.uri)?r=e.libraryResolver._moduleSingletons.get(o.uri):(r=new T(o),r.loadModule(e),e.libraryResolver._moduleSingletons?.set(o.uri,r)),e.globalScope[n]={value:r,valueset:!0,node:t},v}function se(e,t){if(_(e,t.declaration),"FunctionDeclaration"===t.declaration.type)e.exports[t.declaration.id.name.toLowerCase()]="function";else if("VariableDeclaration"===t.declaration.type)for(const n of t.declaration.declarations)e.exports[n.id.name.toLowerCase()]="variable";return v}function ce(e,t){for(let n=0;n<t.declarations.length;n++)_(e,t.declarations[n]);return v}function ue(e,t){let n=null===t.init?null:_(e,t.init);if(n===v&&(n=null),"Identifier"!==t.id.type)throw new l(e,i.InvalidIdentifier,t);const o=t.id.name.toLowerCase();return null!=e.localScope?e.localScope[o]={value:n,valueset:!0,node:t.init}:e.globalScope[o]={value:n,valueset:!0,node:t.init},v}function fe(e,t){try{const n=_(e,t.object);if(null===n)throw new l(e,i.MemberOfNull,t);if(!1===t.computed){if("Identifier"===t.property.type){if(n instanceof r||F(n))return n.field(t.property.name);if(n instanceof G)return o(n,t.property.name,e,t);if(n instanceof T){if(!n.hasGlobal(t.property.name))throw new l(e,i.InvalidIdentifier,t);return n.global(t.property.name)}}throw new l(e,i.InvalidMemberAccessKey,t)}{let a=_(e,t.property);if(n instanceof r||F(n)){if(b(a))return n.field(a);throw new l(e,i.InvalidMemberAccessKey,t)}if(n instanceof T){if(b(a))return n.global(a);throw new l(e,i.InvalidMemberAccessKey,t)}if(n instanceof G){if(b(a))return o(n,a,e,t);throw new l(e,i.InvalidMemberAccessKey,t)}if(x(n)){if(C(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=n.length+a),a>=n.length||a<0)throw new l(e,i.OutOfBounds,t);return n[a]}throw new l(e,i.InvalidMemberAccessKey,t)}if(b(n)){if(C(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=n.length+a),a>=n.length||a<0)throw new l(e,i.OutOfBounds,t);return n[a]}throw new l(e,i.InvalidMemberAccessKey,t)}if(I(n)){if(C(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=n.length()+a),a>=n.length()||a<0)throw new l(e,i.OutOfBounds,t);return n.get(a)}throw new l(e,i.InvalidMemberAccessKey,t)}throw new l(e,i.InvalidMemberAccessKey,t)}}catch(n){throw n}}function pe(e,t){try{const n=_(e,t.argument);if(h(n)){if("!"===t.operator)return!n;if("-"===t.operator)return-1*R(n);if("+"===t.operator)return 1*R(n);if("~"===t.operator)return~R(n);throw new l(e,i.UnsupportedUnaryOperator,t)}if("~"===t.operator)return~R(n);if("-"===t.operator)return-1*R(n);if("+"===t.operator)return 1*R(n);throw new l(e,i.UnsupportedUnaryOperator,t)}catch(n){throw n}}function de(e,t){try{const n=[];for(let o=0;o<t.elements.length;o++){const r=_(e,t.elements[o]);if(y(r))throw new l(e,i.NoFunctionInArray,t);r===v?n.push(null):n.push(r)}return n}catch(n){throw n}}function he(e,t){try{const n=[_(e,t.left),_(e,t.right)],o=n[0],r=n[1];switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return L(R(o),R(r),t.operator);case"==":return w(o,r);case"!=":return!w(o,r);case"<":case">":case"<=":case">=":return E(o,r,t.operator);case"+":return b(o)||b(r)?M(o)+M(r):R(o)+R(r);case"-":return R(o)-R(r);case"*":return R(o)*R(r);case"/":return R(o)/R(r);case"%":return R(o)%R(r);default:throw new l(e,i.UnsupportedOperator,t)}}catch(n){throw n}}function we(e,t){try{const n=_(e,t.left);if(h(n))switch(t.operator){case"||":if(!0===n)return n;{const n=_(e,t.right);if(h(n))return n;throw new l(e,i.LogicExpressionOrAnd,t)}case"&&":if(!1===n)return n;{const n=_(e,t.right);if(h(n))return n;throw new l(e,i.LogicExpressionOrAnd,t)}default:throw new l(e,i.LogicExpressionOrAnd,t)}throw new l(e,i.LogicalExpressionOnlyBoolean,t)}catch(n){throw n}}function me(e,t){return t.value?t.value.cooked:""}function ge(e,t,n){if(y(e))throw new l(t,i.NoFunctionInTemplateLiteral,n);return e}function ve(e,t){let n="",o=0;for(const r of t.quasis)if(n+=r.value?r.value.cooked:"",!1===r.tail){n+=t.expressions[o]?M(ge(_(e,t.expressions[o]),e,t)):"",o++}return n}function ye(e,t){let n;try{const o=t.name.toLowerCase();if(null!=e.localScope&&void 0!==e.localScope[o])return n=e.localScope[o],!0===n.valueset||(n.value=_(e,n.node),n.valueset=!0),n.value;if(void 0!==e.globalScope[o])return n=e.globalScope[o],!0===n.valueset||(n.value=_(e,n.node),n.valueset=!0),n.value;throw new l(e,i.InvalidIdentifier,t)}catch(o){throw o}}function be(e,t){try{if("MemberExpression"===t.callee.type){const n=_(e,t.callee.object);if(!(n instanceof T))throw new l(e,i.FunctionNotFound,t);const o=!1===t.callee.computed?t.callee.property.name:_(e,t.callee.property);if(!n.hasGlobal(o))throw new l(e,i.FunctionNotFound,t);const r=n.global(o);if(!y(r))throw new l(e,i.CallNonFunction,t);return r.call(e,t)}if("Identifier"!==t.callee.type)throw new l(e,i.FunctionNotFound,t);if(null!=e.localScope&&void 0!==e.localScope[t.callee.name.toLowerCase()]){const n=e.localScope[t.callee.name.toLowerCase()];if(y(n.value))return n.value.call(e,t);throw new l(e,i.CallNonFunction,t)}if(void 0!==e.globalScope[t.callee.name.toLowerCase()]){const n=e.globalScope[t.callee.name.toLowerCase()];if(y(n.value))return n.value.call(e,t);throw new l(e,i.CallNonFunction,t)}throw new l(e,i.FunctionNotFound,t)}catch(n){throw n}}const xe={};function Se(e,t,n,o){try{const r=t.arguments,l=_(e,r[n]);if(w(l,o))return _(e,r[n+1]);{const l=r.length-n;return 1===l?_(e,r[n]):2===l?null:3===l?_(e,r[n+2]):Se(e,t,n+2,o)}}catch(r){throw r}}function Ie(e,t,n,o){try{const r=t.arguments;if(!0===o)return _(e,r[n+1]);if(3===r.length-n)return _(e,r[n+2]);{const o=_(e,r[n+2]);if(!1===h(o))throw new l(e,i.BooleanConditionRequired,r[n+2]);return Ie(e,t,n+2,o)}}catch(r){throw r}}function Fe(e,t,n,o){try{const r=e.body;if(n.length!==e.params.length)throw new l(t,i.WrongNumberOfParameters,o);if(null!=t.localScope)for(let o=0;o<n.length;o++)t.localScope[e.params[o].name.toLowerCase()]={value:n[o],valueset:!0,node:null};const a=_(t,r);if(a instanceof S)return a.value;if(a===g)throw new l(t,i.UnexpectedToken,o);if(a===m)throw new l(t,i.UnexpectedToken,o);return a instanceof A?a.value:a}catch(r){throw r}}j(xe,V),q(xe,V),U(xe,V),k(xe,V),K(xe,V),D(xe,V),xe.iif=function(e,t){try{const n=t.arguments;d(null===n?[]:n,3,3,e,t);const o=_(e,n[0]);if(!1===h(o))throw new l(e,i.BooleanConditionRequired,t);return _(e,!0===o?n[1]:n[2])}catch(n){throw n}},xe.defaultvalue=function(e,t){try{const o=t.arguments;d(null===o?[]:o,2,3,e,t);const r=_(e,o[0]);if(3===o.length){const t=_(e,o[1]),l=n(r,t);return null!=l&&""!==l?l:_(e,o[2])}return null===r||""===r||void 0===r?_(e,o[1]):r}catch(o){throw o}},xe.decode=function(e,t){try{const n=t.arguments;if(n.length<2)throw new l(e,i.WrongNumberOfParameters,t);if(2===n.length)return _(e,n[1]);{if((n.length-1)%2==0)throw new l(e,i.WrongNumberOfParameters,t);const o=_(e,n[0]);return Se(e,t,1,o)}}catch(n){throw n}},xe.when=function(e,t){try{const n=t.arguments;if(n.length<3)throw new l(e,i.WrongNumberOfParameters,t);if(n.length%2==0)throw new l(e,i.WrongNumberOfParameters,t);const o=_(e,n[0]);if(!1===h(o))throw new l(e,i.BooleanConditionRequired,n[0]);return Ie(e,t,0,o)}catch(n){throw n}};for(const Ne in xe)xe[Ne]={value:new c(xe[Ne]),valueset:!0,node:null};const Ce=function(){};function Re(e,t,n){const o=new Ce;e||(e={}),t||(t={});const l=new r({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});l.immutable=!1,o.textformatting={value:l,valueset:!0,node:null};for(const r in t)o[r]={value:new c(t[r]),native:!0,valueset:!0,node:null};for(const r in e)e[r]&&"esri.Graphic"===e[r].declaredClass?o[r]={value:s.createFromGraphic(e[r],n),valueset:!0,node:null}:o[r]={value:e[r],valueset:!0,node:null};return o}Ce.prototype=xe,Ce.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Ce.prototype.pi={value:Math.PI,valueset:!0,node:null};const Ae={fixSpatialReference:N,parseArguments:W,standardFunction:V};function Me(e){console.log(e)}function Ee(e){const t={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:V,evaluateIdentifier:ye};for(let n=0;n<e.length;n++)e[n].registerFunctions(t);for(const n in t.functions)xe[n]={value:new c(t.functions[n]),valueset:!0,node:null},Ce.prototype[n]=xe[n];for(let n=0;n<t.signatures.length;n++)O(t.signatures[n],"sync")}function Le(e,n){let o=n.spatialReference;null==o&&(o=new Z({wkid:102100}));let r=null;e.usesModules&&(r=new t(new Map,e.loadedModules));const a={spatialReference:o,globalScope:Re(n.vars,n.customfunctions,n.timeZone),localScope:null,services:n.services??null,exports:{},libraryResolver:r,console:n.console??Me,timeZone:n.timeZone??null,lrucache:n.lrucache,interceptor:n.interceptor,depthCounter:{depth:1}};let s=_(a,e);if(s instanceof S&&(s=s.value),s instanceof A&&(s=s.value),s===v&&(s=null),s===g)throw new l(a,i.IllegalResult,null);if(s===m)throw new l(a,i.IllegalResult,null);if(y(s))throw new l(a,i.IllegalResult,null);return s}Ee([B]);export{Le as executeScript,Ee as extend,Ae as functionHelper};
